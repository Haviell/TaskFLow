/* global use, db */
// MongoDB Playground para TaskFlow
// Conecte-se ao banco taskmanager

// Selecionar o banco de dados correto
use('taskmanager');

// 1. Verificar se a collection tasks existe
const collections = db.getCollectionNames();
print("Collections disponÃ­veis: " + JSON.stringify(collections));

if (!collections.includes('tasks')) {
  db.createCollection('tasks');
  print('âœ… Collection "tasks" criada com sucesso!');
} else {
  print('âœ… Collection "tasks" jÃ¡ existe.');
}

// 2. Inserir tarefas de exemplo
print("\nğŸ¯ Inserindo tarefas de exemplo...");
const result = db.tasks.insertMany([
  {
    title: "Estudar para prova de matemÃ¡tica",
    description: "Revisar capÃ­tulos 5 e 6 do livro",
    category: "academic",
    period: "weekly",
    dueDate: new Date("2024-12-15"),
    completed: false,
    createdAt: new Date()
  },
  {
    title: "Fazer compras do mÃªs",
    description: "Comprar itens de higiene e limpeza",
    category: "personal",
    period: "monthly",
    dueDate: new Date("2024-12-10"),
    completed: false,
    createdAt: new Date()
  },
  {
    title: "ReuniÃ£o com grupo de trabalho",
    description: "Discutir divisÃ£o de tarefas do projeto",
    category: "academic",
    period: "daily",
    dueDate: new Date("2024-12-05"),
    completed: true,
    createdAt: new Date()
  }
]);

print(`âœ… ${result.insertedCount} tarefas inseridas com sucesso!`);

// 3. Consultar todas as tarefas
print("\nğŸ“‹ TODAS AS TAREFAS:");
db.tasks.find().forEach(printjson);

// 4. Consultar tarefas acadÃªmicas
print("\nğŸ“ TAREFAS ACADÃŠMICAS:");
db.tasks.find({ category: "academic" }).forEach(printjson);

// 5. Consultar tarefas pendentes
print("\nâ³ TAREFAS PENDENTES:");
db.tasks.find({ completed: false }).forEach(printjson);

// 6. EstatÃ­sticas
print("\nğŸ“Š ESTATÃSTICAS:");
print("Total de tarefas: " + db.tasks.countDocuments());

// Contar por categoria
db.tasks.aggregate([
  { 
    $group: { 
      _id: "$category", 
      total: { $sum: 1 },
      concluidas: { 
        $sum: { $cond: [{ $eq: ["$completed", true] }, 1, 0] }
      }
    } 
  }
]).forEach(printjson);

print("\nâœ… Playground executado com sucesso! Verifique o frontend.");
use('taskmanager');
db.tasks.find().pretty();
/* global use, db */
// MongoDB Playground para TaskFlow
// Conecte-se ao banco taskmanager

// Selecionar o banco de dados correto
use('taskmanager');

// 1. Verificar se a collection tasks existe
const collections = db.getCollectionNames();
print("Collections disponíveis: " + JSON.stringify(collections));

if (!collections.includes('tasks')) {
  db.createCollection('tasks');
  print('✅ Collection "tasks" criada com sucesso!');
} else {
  print('✅ Collection "tasks" já existe.');
}

// 2. Inserir tarefas de exemplo
print("\n🎯 Inserindo tarefas de exemplo...");
const result = db.tasks.insertMany([
  {
    title: "Estudar para prova de matemática",
    description: "Revisar capítulos 5 e 6 do livro",
    category: "academic",
    period: "weekly",
    dueDate: new Date("2024-12-15"),
    completed: false,
    createdAt: new Date()
  },
  {
    title: "Fazer compras do mês",
    description: "Comprar itens de higiene e limpeza",
    category: "personal",
    period: "monthly",
    dueDate: new Date("2024-12-10"),
    completed: false,
    createdAt: new Date()
  },
  {
    title: "Reunião com grupo de trabalho",
    description: "Discutir divisão de tarefas do projeto",
    category: "academic",
    period: "daily",
    dueDate: new Date("2024-12-05"),
    completed: true,
    createdAt: new Date()
  }
]);

print(`✅ ${result.insertedCount} tarefas inseridas com sucesso!`);

// 3. Consultar todas as tarefas
print("\n📋 TODAS AS TAREFAS:");
db.tasks.find().forEach(printjson);

// 4. Consultar tarefas acadêmicas
print("\n🎓 TAREFAS ACADÊMICAS:");
db.tasks.find({ category: "academic" }).forEach(printjson);

// 5. Consultar tarefas pendentes
print("\n⏳ TAREFAS PENDENTES:");
db.tasks.find({ completed: false }).forEach(printjson);

// 6. Estatísticas
print("\n📊 ESTATÍSTICAS:");
print("Total de tarefas: " + db.tasks.countDocuments());

// Contar por categoria
db.tasks.aggregate([
  { 
    $group: { 
      _id: "$category", 
      total: { $sum: 1 },
      concluidas: { 
        $sum: { $cond: [{ $eq: ["$completed", true] }, 1, 0] }
      }
    } 
  }
]).forEach(printjson);

print("\n✅ Playground executado com sucesso! Verifique o frontend.");
use('taskmanager');
db.tasks.find().pretty();